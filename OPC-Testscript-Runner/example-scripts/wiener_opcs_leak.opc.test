init('', 'WIENER.Plein.Baus.OPC.Server.DA')

logInfo('script creates and destroys OPC client groupings for Wiener OPCS')

for(i in 1..10)
{
	def groupName = 'test.group.'+i
	
	// create group here
	def testGroup = group(groupName)
	
	// add all items to group here
	testGroup.with
	{
		def groupItems = items('**')
		sleep(500)

		logInfo("group [${groupName}] has [${groupItems.size()}] items")

		def channelOnOffs = items('**.Channel.*.OnOff')
		logInfo("number of channels [${channelOnOffs.size()}]")

		// toggle all rise rates (value 2 or 4)
		items('**Channel.*.VoltageRiseRate').each{it.syncValue = (i%2? '2': '4')}
		sleep(500)

		// turn all channels on
		channelOnOffs.each {it.syncValue = '1'}		
		sleep(500)

		// adjust all fall rates (value 2 or 4)
		items('**Channel.*.VoltageFallRate').each{it.syncValue = (i%2? '2': '4')}
		sleep(500)

		// turn all channels off
		channelOnOffs.each {it.syncValue = '0'}
		sleep(500)	
	}
	
	// destroy group here
	testGroup.destroy()
}

logInfo('end of script')